---
title: Norming
date: "`r Sys.Date()`"
author: "fredcallaway"
output:
  rmdformats::robobook:
    code_folding: hide
    self_contained: true
---


```{r setup, include=FALSE}
source("base.r")
acc = read_csv('../data/acc-v2.0/accessibility.csv', col_types = cols())
```

```{r}
acc %>% 
    group_by(cat_id) %>% 
    summarise(mean(outcome == "UNK"))

acc %>% 
    filter(outcome != "UNK") %>% 
    count(cat_id,outcome) %>% 
    filter(n >= 3) %>% 
    count(cat_id)
```

```{r}

acc %>% 
    filter(outcome != "UNK") %>% 
    count(cat_id,outcome) %>% 
    filter(outcome %in% c("ape", "gorilla", "chimpanzee", "monkey"))
```




1 ANIMALS      
2 SPORTS       
3 SUBJECTS     
4 TRANSPORT    

```{r}
acc %>% 
    filter(outcome == "UNK") %>% 
    filter(cat_id == "TRANSPORT") %>% 
    arrange(cat_id,raw_outcome) %>% 
    with(paste(raw_outcome, collapse=", "))
```

```{r}
acc %>% 
    filter(outcome != "UNK") %>% 
    count(cat_id,outcome) %>% 
    arrange(-n) %>% 
    slice_head(n=5)
```

```{r}
acc %>% 
    filter(outcome != "UNK") %>% 
    count(cat_id,outcome) %>% 
    group_by(cat_id) %>%
    filter(n>=3) %>% 
    count(cat_id)
```

```{r}
N = acc %>% with(length(unique(wid)))
acc %>% 
    filter(outcome != "UNK") %>% 
    count(cat_id, outcome) %>% 
    transmute(cat_id, outcome, prop=n/N) %>% 
    ggplot(aes(p)) + stat_ecdf() + facet_wrap(~cat_id)
```




motorcycle
hippo
dolphin
penguin
snake
lacrosse


math
science
social studies

ship -> boat
subway -> train

```{r}
unk_df %>% filter(considered & startsWith(scenario, "subjects")) %>% with(raw_outcome)

unk_df %>% filter(considered) %>% 
    group_by(scenario) %>% 
    summarise(mean(outcome=="UNK"))

unk_df %>% filter(considered) %>% 
    group_by(scenario) %>% 
    summarise(sum(outcome!="UNK"))

```

```{r}

df %>% filter(considered & startsWith(scenario, "vehicles")) %>% with(outcome)

get_counts = function(cat) {
    acc %>% 
        filter(cat_id == cat) %>% 
        filter(outcome != 'UNK') %>% 
        mutate(outcome = factor(outcome, levels=OUTCOMES[[cat]])) %>% 
        count(outcome, .drop=F)
}

get_counts("SUBJECTS")
get_counts("SPORTS")
get_counts("ANIMALS")
get_counts("TRANSPORT")


```

```{r}
df %>% 
    filter(considered & startsWith(scenario, "vehicles")) %>% 
    mutate(outcome = factor(outcome, levels=TRANSPORT)) %>% 
    count(outcome, .drop=F)

```

```{r}
acc %>% 
    filter(outcome != "UNK") %>% 
    mutate(outcome = factor(outcome, levels=all_outcomes)) %>% 
    count(cat_id,outcome)
```

```{r}
df %>% 
    filter(considered) %>% count(outcome)

scenarios %>% 
    filter(startsWith(scenario, "subjects")) %>% 
    with(considered)

```